# 🇰🇷 Koracle - Mass Liquidation Prevention System

빗썸 렌딩 서비스 대규모 청산 사태 방지를 위한 가격 산출 오라클 프로젝트입니다.

## 📋 목차

- [주요 기능](#주요-기능)
- [지원 거래소](#지원-거래소)
- [설치 및 실행](#설치-및-실행)
- [작동 원리](#작동-원리)
- [UI 기능](#ui-기능)
- [프로젝트 구조](#프로젝트-구조)
- [기술 스택](#기술-스택)
- [주의사항](#주의사항)

## ✨ 주요 기능

### 핵심 기능
- **다중 거래소 가격 수집**: 여러 CEX에서 실시간 가격 데이터 수집
- **중앙값 계산**: 수집된 가격들의 중앙값을 계산하여 조작 방지
- **김치 프리미엄 고려**: 해외 거래소 가격을 USDT/KRW 환율로 변환
- **변동성 감지**: TWAP(Time-Weighted Average Price) 기반 USDT/KRW 급격한 변동 감지
- **역산 모드**: 변동성 감지 시 국내 가격 기반으로 USDT/KRW 역산

### 웹 대시보드
- **실시간 모니터링**: WebSocket을 통한 실시간 가격 업데이트
- **가격 차트**: Chart.js를 사용한 가격 추이 시각화
- **상세 정보**: 각 거래소별 가격 및 계산 방법 표시
- **다크모드**: 미니멀한 토글 스위치로 다크모드 지원
- **테스트 기능**: USDT/KRW 가격 조작 게이지 (1,000원 ~ 6,000원 범위)

## 🏦 지원 거래소

### 국내 거래소
- **Upbit**: ETH/KRW, USDT/KRW

### 해외 거래소
- **Binance**: ETH/USDT
- **OKX**: ETH/USDT
- **Coinbase**: ETH/USDT (선택적)
- **Kraken**: ETH/USDT (선택적)
- **Bybit**: ETH/USDT (선택적)

## 🚀 설치 및 실행

### 요구사항
- Python 3.8 이상
- pip

### 설치

```bash
# 저장소 클론 (또는 다운로드)
git clone <repository-url>
cd KUSDT

# 의존성 설치
pip install -r requirements.txt
```

### 실행

```bash
python app.py
```

웹 브라우저에서 `http://localhost:5000` 접속

## 🔧 작동 원리

### 정상 모드 (Normal Mode)

1. **가격 수집**
   - 업비트에서 ETH/KRW, USDT/KRW 가격 수집
   - 해외 거래소(Binance, OKX, Coinbase 등)에서 ETH/USDT 가격 수집

2. **가격 변환**
   - 해외 거래소 가격을 KRW로 변환: `ETH/KRW = ETH/USDT × USDT/KRW`
   - 김치 프리미엄을 자동으로 반영

3. **중앙값 계산**
   - 업비트 ETH/KRW와 변환된 해외 거래소 가격들의 중앙값 계산
   - 조작된 가격의 영향을 최소화

### 변동성 모드 (Volatility Mode / 역산 모드)

USDT/KRW 가격이 급격히 변동할 때 자동으로 전환됩니다.

1. **변동성 감지**
   - TWAP(5분 윈도우)을 사용하여 USDT/KRW 변동성 계산
   - 변동성이 임계값(기본 5%)을 초과하면 역산 모드 전환

2. **USDT/KRW 역산**
   - 국내 ETH/KRW 가격과 해외 ETH/USDT 가격을 사용
   - `USDT/KRW = ETH/KRW ÷ ETH/USDT` 공식으로 역산

3. **가격 재계산**
   - 역산된 USDT/KRW로 해외 거래소 가격 재변환
   - 모든 가격의 중앙값 재계산

### 테스트 기능

- 대시보드에서 USDT/KRW 가격을 게이지로 조작 (1,000원 ~ 6,000원)
- 급격한 USDT 가격 변동 시 오라클의 저항성 테스트
- 변동성 모드 자동 전환 확인

## 🎨 UI 기능

### 실시간 대시보드
- **가격 차트**: 중앙값 가격과 업비트 ETH/KRW 가격 추이 시각화
- **중앙값 표시**: 큰 숫자로 중앙값 가격 강조 표시
- **가격 비교**: 업비트 가격과의 차이 및 퍼센티지 표시
- **상세 정보**: 각 거래소별 가격 및 계산 방법 표시
  - 거래소 이름 자동 포맷팅 (첫 글자 대문자, OKX는 전체 대문자)
  - "(Converted)" 표시로 변환된 가격 구분

### 다크모드
- 우측 상단의 미니멀한 토글 스위치로 다크모드 전환
- 설정은 localStorage에 저장되어 다음 방문 시에도 유지
- 차트 색상도 다크모드에 맞게 자동 조정

### 실시간 업데이트
- WebSocket을 통한 실시간 가격 업데이트
- WebSocket 연결 실패 시 HTTP 폴링으로 자동 폴백
- 1초마다 자동 업데이트

## 📁 프로젝트 구조

```
KUSDT/
├── app.py                 # Flask 웹 애플리케이션 메인 파일
├── oracle.py               # 오라클 핵심 로직 (중앙값 계산, 변동성 감지)
├── price_fetcher.py       # CCXT를 사용한 거래소 가격 수집
├── requirements.txt       # Python 의존성 목록
├── README.md              # 프로젝트 문서
├── templates/
│   └── index.html         # 메인 대시보드 HTML 템플릿
└── static/
    ├── style.css          # 스타일시트 (다크모드 포함)
    └── script.js          # 클라이언트 사이드 JavaScript
```

## 🛠 기술 스택

### Backend
- **Flask**: 웹 프레임워크
- **Flask-SocketIO**: WebSocket 지원
- **CCXT**: 암호화폐 거래소 API 통합 라이브러리
- **Pandas/NumPy**: 데이터 처리

### Frontend
- **Chart.js**: 가격 차트 시각화
- **Socket.IO**: 실시간 데이터 통신
- **Vanilla JavaScript**: 클라이언트 사이드 로직
- **CSS3**: 스타일링 및 다크모드

## ⚠️ 주의사항

### 운영 환경
- 실제 운영 환경에서는 API 키 설정 및 속도 제한 관리가 필요할 수 있습니다.
- 네트워크 오류 시 캐시된 가격을 사용합니다.
- 변동성 임계값은 환경에 맞게 조정이 필요할 수 있습니다.

### 테스트 기능
- USDT/KRW 가격 조작 기능은 테스트 목적으로만 사용하세요.
- 실제 운영 환경에서는 이 기능을 비활성화하는 것을 권장합니다.

### 거래소 지원
- 일부 해외 거래소(Coinbase, Kraken, Bybit)는 선택적으로 초기화됩니다.
- 거래소 초기화 실패 시 해당 거래소는 제외되고 계속 진행됩니다.

## 📝 라이선스

이 프로젝트는 빗썸 렌딩 서비스 대규모 청산 사태 방지를 위한 목적으로 개발되었습니다.
